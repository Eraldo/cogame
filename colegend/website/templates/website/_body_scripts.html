{% load bootstrap3 %}
{% bootstrap_javascript %}

{# select active menu item #}
<script>
    if (location.pathname.split("/")[1] == "") {
        $('#menu a[href="/"][class!="noselect"]').parent().addClass('active');
    } else {
        $('#menu a[href*="' + location.pathname.split("/")[1] + '"][class!="noselect"]').parent().addClass('active');
    }
</script>

{# tooltips #}
<script>
    $('[data-toggle="tooltip"]').tooltip();
</script>

{# jqueryUI #}
<script src="{{ STATIC_URL }}website/bower_components/jquery-ui/jquery-ui.min.js"></script>

{# datepicker #}
<script>
    {#    $(function() {#}
    $(".dateinput").datepicker({
        dateFormat: $.datepicker.ISO_8601,
        firstDay: 1,
        changeMonth: true,
        changeYear: true
    });
</script>

{# datetimepicker #}
<script src="{{ STATIC_URL }}website/bower_components/smalot-bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script>
    $('.datetimeinput').datetimepicker({
        weekStart: 1,
        autoclose: true
    });
</script>

{# keyboard shortcuts #}
{% if user.settings.keyboard %}
    {% load keyboard %}{% keyboard %}
    <script>
        // Helper variables and functions.
        var item_class = "nav-item";
        var selection_class = "selected";

        function _get_selected_item() {
            return $('.' + item_class + '.' + selection_class)[0];
        }
        function _select_item(item) {
            if (item) {
                $(item).addClass(selection_class);
            }
        }
        function _deselect_item() {
            var item = _get_selected_item();
            if (item) {
                $(item).removeClass(selection_class);
            }
        }
        function _click_selected_or_global_button(button_class) {
            // click the complete button of the selected item
            // or click on the first found non-item complete button
            var item = _get_selected_item();
            if (item) {
                var button = item.getElementsByClassName("item-" + button_class)[0];
            } else {
                // Get the top most non-item complete button.
                var button = $("." + button_class)[0];
            }
            if (button) {
                button.click();
            }
        }

        function keyboard_help() {
            // Redirect to the keyboard tutorial.
            window.open("{% url "tutorials:keyboard" %}");
        }
        function keyboard_deselect() {
            // Deselect currently selected item.
            _deselect_item();
            // Unfocus the active element if it is an input field.
            var element = document.activeElement;
            var tag = element.tagName;
            // If the active element is a nav-item or input element.
            if (tag == "INPUT" || tag == "SELECT" || tag == "TEXTAREA" || tag.isContentEditable) {
                element.blur();
            }
        }
        function keyboard_menu(main) {
            if (main) {
                // focus the main menu
                $("#menu a")[0].focus();
            } else {
                // focus the page menu
                var page_menu = $("#page-menu .btn")[0];
                if (page_menu) {
                    page_menu.focus();
                }
            }
        }

        function keyboard_new() {
            _click_selected_or_global_button("new-button");
        }
        function keyboard_show() {
            // open the detail page of the selected item
            // or open the open-button
            var item = _get_selected_item();
            if (item) {
                var url = item.getAttribute("data-url");
                if (url) {
                    window.location.href = url;
                }
            } else {
                _click_selected_or_global_button("open-button");
            }
        }
        function keyboard_edit() {
            _click_selected_or_global_button("edit-button");
        }
        function keyboard_delete() {
            _click_selected_or_global_button("delete-button");
        }
        function keyboard_complete() {
            _click_selected_or_global_button("complete-button");
        }

        function keyboard_save() {
            _click_selected_or_global_button("save-button");
        }
        function keyboard_cancel() {
            _click_selected_or_global_button("cancel-button");
        }

        function keyboard_navigate(direction) {
            var item = _get_selected_item();
            if (item) { // selection exists
                if (direction == "down") {
                    var next = $(item).next('.' + item_class)[0];
                } else if (direction == "up") {
                    var next = $(item).prev('.' + item_class)[0];
                }
            } else {
                if (direction == "down") {
                    var next = $('.' + item_class).first()[0];
                } else if (direction == "up") {
                    var next = $('.' + item_class).last()[0];
                }
            }
            if (next) {
                $(item).removeClass(selection_class);
                $(next).addClass(selection_class);
                // scroll to item
                $('html, body').animate({
                    scrollTop: $(next).offset().top - ($(window).height() / 2) + 'px'
                }, 0);
            }
        }
    </script>
{% endif %}
