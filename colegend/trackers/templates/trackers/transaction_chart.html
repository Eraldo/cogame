{% extends 'page.html' %}

{% load icons %}

{% block page_title %}
    Transaction Charts
{% endblock %}

{% block up_url %}{% url "trackers:transaction_list" %}{% endblock %}

{% block extra_head %}
    {{ block.super }}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    {# Time Chart #}
    <script type='text/javascript'>
        google.setOnLoadCallback(drawChart);
        google.load('visualization', '1', {'packages': ['annotationchart']});
        function drawChart() {
            var data = new google.visualization.DataTable();
            data.addColumn('datetime', 'Time');
            data.addColumn('number', 'Balance (€)');
            data.addColumn('number', 'Amount (€)');
            data.addColumn('string', 'Notes');
            data.addRows([
                {% for row in object_list %}
                    [new Date({{ row.time.year }}, {{ row.time.month }}-1, {{ row.time.day }}, {{ row.time.hour }}, {{ row.time.minute }}), {{ row.cumulative }}, {{ row.value }}, '{{ row.notes }}'],
                {% endfor %}
            ]);
            var chart = new google.visualization.AnnotationChart(document.getElementById('timechart'));
            var options = {
            };
            chart.draw(data, options);
        }
    </script>
    {# Category Chart #}
    <script type="text/javascript">
        google.load("visualization", "1", {packages: ["corechart"]});
        google.setOnLoadCallback(drawChart);
        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Category', '€'],
                {% for category, amount in categories %}
                    ['{{ category }}', {{ amount|default:0 }}],
                {% endfor %}
            ]);
            var options = {
                title: 'Categories (€)',
{#                legend: 'none',#}
                slices: {
                    0: {color: 'darkviolet'},
                    1: {color: 'indigo'},
                    2: {color: 'dodgerblue'},
                    3: {color: 'green'},
                    4: {color: 'gold'},
                    5: {color: 'darkorange'},
                    6: {color: 'crimson'}
                }
            };
            var chart = new google.visualization.PieChart(document.getElementById('piechart'));
            chart.draw(data, options);
        }
    </script>
    {# Tag Chart #}
    <script type="text/javascript">
        google.load("visualization", "1", {packages: ["corechart"]});
        google.setOnLoadCallback(drawChart);
        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Tag', '€'],
                {% for tag, amount in tags %}
                    ['{{ tag }}', {{ amount|default:0 }}],
                {% endfor %}
            ]);
            var options = {
                title: 'Tags (€)'
            };
            var chart = new google.visualization.PieChart(document.getElementById('tag-chart'));
            chart.draw(data, options);
        }
    </script>
{% endblock %}

{% block page_title_extras %}
    <span class="label label-{% if balance > 0 %}success{% elif balance < 0 %}danger{% else %}default{% endif %}">Balance: € {{ balance|floatformat:2 }}</span>
    <span class="label label-default">- Expenses: € {{ expenses|default:0|floatformat:2 }}</span>
    <span class="label label-default">+ Income: € {{ income|default:0|floatformat:2 }}</span>
{% endblock %}

{% block page_content %}
    <form class="form-inline" method="GET" action=".">
        <div class="form-group">
            <label for="year">Year</label>
            <input id="year" name="year" type="number" min="1900" max="{% now "Y" %}" class="form-control"
                   value="{{ year }}"/>
            <label for="month">Month</label>
            <input id="month" name="month" type="number" min="1" max="12" class="form-control" value="{{ month }}"/>
            <button class="btn btn-default" type="submit">{% icon "refresh" %}</button>
        </div>
    </form>
    <div class="row">
        <div class="col-md-8">
            <div id='timechart' style='width: 100%; height: 400px; padding: 0px;'></div>
        </div>
        <div class="col-md-4">
            <div id="piechart" style="width: 100%; height: 200px;"></div>
            <div id="tag-chart" style="width: 100%; height: 200px;"></div>
        </div>
        <div class="col-md-4">
        </div>
    </div>
{% endblock %}
